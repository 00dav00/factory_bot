<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Factory girl by thoughtbot</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Factory girl</h1>
        <p>A library for setting up Ruby objects as test data.</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/thoughtbot/factory_girl" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/thoughtbot/factory_girl/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/thoughtbot/factory_girl/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>factory_girl <a href="http://travis-ci.org/thoughtbot/factory_girl?branch=master"><img src="https://secure.travis-ci.org/thoughtbot/factory_girl.png" alt="Build Status"></a> <a href="https://gemnasium.com/thoughtbot/factory_girl"><img src="https://gemnasium.com/thoughtbot/factory_girl.png" alt="Dependency Status"></a>
</h1>

<p>factory_girl is a fixtures replacement with a straightforward definition syntax, support for multiple build strategies (saved instances, unsaved instances, attribute hashes, and stubbed objects), and support for multiple factories for the same class (user, admin_user, and so on), including factory inheritance.</p>

<p>If you want to use factory_girl with Rails, see
<a href="https://github.com/thoughtbot/factory_girl_rails">factory_girl_rails</a>.</p>

<h2>Documentation</h2>

<p>You should find the documentation for your version of factory_girl on <a href="https://rubygems.org/gems/factory_girl">Rubygems</a>.</p>

<p>See <a href="https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md">GETTING_STARTED</a> for information on defining and using factories.</p>

<h2>Install</h2>

<div class="highlight"><pre>gem install factory_girl
</pre></div>

<p>or add the following line to Gemfile:</p>

<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'factory_girl'</span>
</pre></div>

<p>and run <code>bundle install</code> from your shell.</p>

<h2>Supported Ruby versions</h2>

<p>The FactoryGirl 3.x+ series supports MRI Ruby 1.9. Additionally, FactoryGirl
3.6+ supports JRuby 1.6.7.2+ while running in 1.9 mode. See
<a href="https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md">GETTING_STARTED</a>
for more information on configuring the JRuby environment.</p>

<p>For versions of Ruby prior to 1.9, please use FactoryGirl 2.x.</p>

<h2>More Information</h2>

<ul>
<li><a href="https://rubygems.org/gems/factory_girl">Rubygems</a></li>
<li><a href="http://groups.google.com/group/factory_girl">Mailing list</a></li>
<li><a href="https://github.com/thoughtbot/factory_girl/issues">Issues</a></li>
<li><a href="http://robots.thoughtbot.com/">GIANT ROBOTS SMASHING INTO OTHER GIANT ROBOTS</a></li>
</ul><h2>Contributing</h2>

<p>Please see the <a href="https://github.com/thoughtbot/factory_girl/blob/master/CONTRIBUTION_GUIDELINES.md">contribution guidelines</a>.</p>

<h2>Credits</h2>

<p>factory_girl was written by Joe Ferris with contributions from several authors, including:</p>

<ul>
<li>Alex Sharp</li>
<li>Eugene Bolshakov</li>
<li>Jon Yurek</li>
<li>Josh Nichols</li>
<li>Josh Owens</li>
<li>Nate Sutton</li>
<li>Josh Clayton</li>
<li>Thomas Walpole</li>
</ul><p><img src="http://thoughtbot.com/images/tm/logo.png" alt="thoughtbot"></p>

<p>factory_girl is maintained and funded by <a href="http://thoughtbot.com/community">thoughtbot, inc</a></p>

<p>The names and logos for thoughtbot are trademarks of thoughtbot, inc.</p>

<h2>License</h2>

<p>factory_girl is Copyright Â© 2008-2012 Joe Ferris and thoughtbot. It is free software, and may be redistributed under the terms specified in the LICENSE file.</p>

<h1>Getting Started</h1>

<h2>Update Your Gemfile</h2>

<p>If you're using Rails, you'll need to change the required version of <code>factory_girl_rails</code>:</p>

<div class="highlight"><pre><span class="n">gem</span> <span class="s2">"factory_girl_rails"</span><span class="p">,</span> <span class="s2">"~&gt; 4.0"</span>
</pre></div>

<p>If you're <em>not</em> using Rails, you'll just have to change the required version of <code>factory_girl</code>:</p>

<div class="highlight"><pre><span class="n">gem</span> <span class="s2">"factory_girl"</span><span class="p">,</span> <span class="s2">"~&gt; 4.0"</span>
</pre></div>

<p>JRuby users: FactoryGirl works with JRuby starting with 1.6.7.2 (latest stable, as per July 2012).
JRuby has to be used in 1.9 mode, for that, use JRUBY_OPTS environment variable:</p>

<pre><code>export JRUBY_OPTS=--1.9
</code></pre>

<p>Once your Gemfile is updated, you'll want to update your bundle.</p>

<h2>Using Without Bundler</h2>

<p>If you're not using Bundler, be sure to have the gem installed and call:</p>

<pre><code>require 'factory_girl'
</code></pre>

<p>Once required, assuming you have a directory structure of <code>spec/factories</code> or
<code>test/factories</code>, all you'll need to do is run</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">find_definitions</span>
</pre></div>

<p>If you're using a separate directory structure for your factories, you can
change the definition file paths before trying to find definitions:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">definition_file_paths</span> <span class="o">=</span> <span class="sx">%w(custom_factories_directory)</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">find_definitions</span>
</pre></div>

<p>If you don't have a separate directory of factories and would like to define
them inline, that's possible as well:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'factory_girl'</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s1">'John Doe'</span>
    <span class="n">date_of_birth</span> <span class="p">{</span> <span class="mi">21</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>Defining factories</h2>

<p>Each factory has a name and a set of attributes. The name is used to guess the class of the object by default, but it's possible to explicitly specify it:</p>

<div class="highlight"><pre><span class="c1"># This will guess the User class</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">first_name</span> <span class="s2">"John"</span>
    <span class="n">last_name</span>  <span class="s2">"Doe"</span>
    <span class="n">admin</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="c1"># This will use the User class (Admin would have been guessed)</span>
  <span class="n">factory</span> <span class="ss">:admin</span><span class="p">,</span> <span class="n">class</span><span class="p">:</span> <span class="no">User</span> <span class="k">do</span>
    <span class="n">first_name</span> <span class="s2">"Admin"</span>
    <span class="n">last_name</span>  <span class="s2">"User"</span>
    <span class="n">admin</span>      <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>It is highly recommended that you have one factory for each class that provides the simplest set of attributes necessary to create an instance of that class. If you're creating ActiveRecord objects, that means that you should only provide attributes that are required through validations and that do not have defaults. Other factories can be created through inheritance to cover common scenarios for each class.</p>

<p>Attempting to define multiple factories with the same name will raise an error.</p>

<p>Factories can be defined anywhere, but will be automatically loaded if they
are defined in files at the following locations:</p>

<pre><code>test/factories.rb
spec/factories.rb
test/factories/*.rb
spec/factories/*.rb
</code></pre>

<h2>Using factories</h2>

<p>factory_girl supports several different build strategies: build, create, attributes_for and build_stubbed:</p>

<div class="highlight"><pre><span class="c1"># Returns a User instance that's not saved</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>

<span class="c1"># Returns a saved User instance</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>

<span class="c1"># Returns a hash of attributes that can be used to build a User instance</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">attributes_for</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>

<span class="c1"># Returns an object with all defined attributes stubbed out</span>
<span class="n">stub</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build_stubbed</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>

<span class="c1"># Passing a block to any of the methods above will yield the return object</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="n">user</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">attributes_for</span><span class="p">(</span><span class="ss">:post</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>

<p>No matter which strategy is used, it's possible to override the defined attributes by passing a hash:</p>

<div class="highlight"><pre><span class="c1"># Build a User instance and override the first_name property</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="n">first_name</span><span class="p">:</span> <span class="s2">"Joe"</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">first_name</span>
<span class="c1"># =&gt; "Joe"</span>
</pre></div>

<p>If repeating "FactoryGirl" is too verbose for you, you can mix the syntax methods in:</p>

<div class="highlight"><pre><span class="c1"># rspec</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
<span class="k">end</span>

<span class="c1"># Test::Unit</span>
<span class="k">class</span> <span class="nc">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
<span class="k">end</span>

<span class="c1"># Cucumber</span>
<span class="no">World</span><span class="p">(</span><span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span><span class="p">)</span>

<span class="c1"># MiniTest</span>
<span class="k">class</span> <span class="nc">MiniTest</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
<span class="k">end</span>

<span class="c1"># MiniTest::Spec</span>
<span class="k">class</span> <span class="nc">MiniTest</span><span class="o">::</span><span class="no">Spec</span>
  <span class="kp">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
<span class="k">end</span>

<span class="c1"># minitest-rails</span>
<span class="k">class</span> <span class="nc">MiniTest</span><span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
<span class="k">end</span>
</pre></div>

<p>This allows you to use the core set of syntax methods (<code>build</code>,
<code>build_stubbed</code>, <code>create</code>, <code>attributes_for</code>, and their <code>*_list</code> counterparts)
without having to call them on FactoryGirl directly:</p>

<div class="highlight"><pre><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s2">"#full_name"</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="n">first_name</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s2">"Doe"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">its</span><span class="p">(</span><span class="ss">:full_name</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="o">==</span> <span class="s2">"John Doe"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<h2>Lazy Attributes</h2>

<p>Most factory attributes can be added using static values that are evaluated when
the factory is defined, but some attributes (such as associations and other
attributes that must be dynamically generated) will need values assigned each
time an instance is generated. These "lazy" attributes can be added by passing a
block instead of a parameter:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">activation_code</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">generate_activation_code</span> <span class="p">}</span>
  <span class="n">date_of_birth</span>   <span class="p">{</span> <span class="mi">21</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>In addition to running other methods dynamically, you can use FactoryGirl's
syntax methods (like <code>build</code>, <code>create</code>, and <code>generate</code>) within dynamic
attributes without having to prefix the call with <code>FactoryGirl.</code>. This allows
you to do:</p>

<div class="highlight"><pre><span class="n">sequence</span><span class="p">(</span><span class="ss">:random_string</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="no">LoremIpsum</span><span class="o">.</span><span class="n">generate</span> <span class="p">}</span>

<span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="p">{</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:random_string</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># instead of FactoryGirl.generate(:random_string)</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:comment</span> <span class="k">do</span>
  <span class="n">post</span>
  <span class="n">body</span> <span class="p">{</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:random_string</span><span class="p">)</span> <span class="p">}</span>  <span class="c1"># instead of FactoryGirl.generate(:random_string)</span>
<span class="k">end</span>
</pre></div>

<h2>Aliases</h2>

<p>Aliases allow you to use named associations more easily.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:author</span><span class="p">,</span> <span class="ss">:commenter</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">first_name</span>    <span class="s2">"John"</span>
  <span class="n">last_name</span>     <span class="s2">"Doe"</span>
  <span class="n">date_of_birth</span> <span class="p">{</span> <span class="mi">18</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">author</span>
  <span class="c1"># instead of</span>
  <span class="c1"># association :author, factory: :user</span>
  <span class="n">title</span> <span class="s2">"How to read a book effectively"</span>
  <span class="n">body</span>  <span class="s2">"There are five steps involved."</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:comment</span> <span class="k">do</span>
  <span class="n">commenter</span>
  <span class="c1"># instead of</span>
  <span class="c1"># association :commenter, factory: :user</span>
  <span class="n">body</span> <span class="s2">"Great article!"</span>
<span class="k">end</span>
</pre></div>

<h2>Dependent Attributes</h2>

<p>Attributes can be based on the values of other attributes using the evaluator that is yielded to lazy attribute blocks:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">first_name</span> <span class="s2">"Joe"</span>
  <span class="n">last_name</span>  <span class="s2">"Blow"</span>
  <span class="n">email</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">@example.com"</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s2">"Doe"</span><span class="p">)</span><span class="o">.</span><span class="n">email</span>
<span class="c1"># =&gt; "joe.doe@example.com"</span>
</pre></div>

<h2>Transient Attributes</h2>

<p>There may be times where your code can be DRYed up by passing in transient attributes to factories.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">ignore</span> <span class="k">do</span>
    <span class="n">rockstar</span> <span class="kp">true</span>
    <span class="n">upcased</span>  <span class="kp">false</span>
  <span class="k">end</span>

  <span class="nb">name</span>  <span class="p">{</span> <span class="s2">"John Doe</span><span class="si">#{</span><span class="s2">" - Rockstar"</span> <span class="k">if</span> <span class="n">rockstar</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="n">email</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">downcase</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
    <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upcase!</span> <span class="k">if</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">upcased</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="n">upcased</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="c1">#=&gt; "JOHN DOE - ROCKSTAR"</span>
</pre></div>

<p>Static and dynamic attributes can be ignored. Ignored attributes will be ignored
within attributes_for and won't be set on the model, even if the attribute
exists or you attempt to override it.</p>

<p>Within FactoryGirl's dynamic attributes, you can access ignored attributes as
you would expect. If you need to access the evaluator in a FactoryGirl callback,
you'll need to declare a second block argument (for the evaluator) and access
ignored attributes from there.</p>

<h2>Associations</h2>

<p>It's possible to set up associations within factories. If the factory name is the same as the association name, the factory name can be left out.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">author</span>
<span class="k">end</span>
</pre></div>

<p>You can also specify a different factory or override attributes:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">association</span> <span class="ss">:author</span><span class="p">,</span> <span class="n">factory</span><span class="p">:</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s2">"Writely"</span>
<span class="k">end</span>
</pre></div>

<p>The behavior of the association method varies depending on the build strategy used for the parent object.</p>

<div class="highlight"><pre><span class="c1"># Builds and saves a User and a Post</span>
<span class="n">post</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">new_record?</span>        <span class="c1"># =&gt; false</span>
<span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">new_record?</span> <span class="c1"># =&gt; false</span>

<span class="c1"># Builds and saves a User, and then builds but does not save a Post</span>
<span class="n">post</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">new_record?</span>        <span class="c1"># =&gt; true</span>
<span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">new_record?</span> <span class="c1"># =&gt; false</span>
</pre></div>

<p>To not save the associated object, specify strategy: :build in the factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">association</span> <span class="ss">:author</span><span class="p">,</span> <span class="n">factory</span><span class="p">:</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="ss">:build</span>
<span class="k">end</span>

<span class="c1"># Builds a User, and then builds a Post, but does not save either</span>
<span class="n">post</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">new_record?</span>        <span class="c1"># =&gt; true</span>
<span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">new_record?</span> <span class="c1"># =&gt; true</span>
</pre></div>

<p>Please note that the <code>strategy: :build</code> option must be passed to an explicit call to <code>association</code>,
and cannot be used with implicit associations:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">author</span> <span class="n">strategy</span><span class="p">:</span> <span class="ss">:build</span>    <span class="c1"># &lt;&lt;&lt; this does *not* work; causes author_id to be nil</span>
</pre></div>

<p>Generating data for a <code>has_many</code> relationship is a bit more involved,
depending on the amount of flexibility desired, but here's a surefire example
of generating associated data.</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>

  <span class="c1"># post factory with a `belongs_to` association for the user</span>
  <span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
    <span class="n">title</span> <span class="s2">"Through the Looking Glass"</span>
    <span class="n">user</span>
  <span class="k">end</span>

  <span class="c1"># user factory without associated posts</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s2">"John Doe"</span>

    <span class="c1"># user_with_posts will create post data after the user has been created</span>
    <span class="n">factory</span> <span class="ss">:user_with_posts</span> <span class="k">do</span>
      <span class="c1"># posts_count is declared as an ignored attribute and available in</span>
      <span class="c1"># attributes on the factory, as well as the callback via the evaluator</span>
      <span class="n">ignore</span> <span class="k">do</span>
        <span class="n">posts_count</span> <span class="mi">5</span>
      <span class="k">end</span>

      <span class="c1"># the after(:create) yields two values; the user instance itself and the</span>
      <span class="c1"># evaluator, which stores all values from the factory, including ignored</span>
      <span class="c1"># attributes; `create_list`'s second argument is the number of records</span>
      <span class="c1"># to create and we make sure the user is associated properly to the post</span>
      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
        <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create_list</span><span class="p">(</span><span class="ss">:post</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">posts_count</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>This allows us to do:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">length</span> <span class="c1"># 0</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user_with_posts</span><span class="p">)</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">length</span> <span class="c1"># 5</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user_with_posts</span><span class="p">,</span> <span class="n">posts_count</span><span class="p">:</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">length</span> <span class="c1"># 15</span>
</pre></div>

<h2>Inheritance</h2>

<p>You can easily create multiple factories for the same class without repeating common attributes by nesting factories:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="s2">"A title"</span>

  <span class="n">factory</span> <span class="ss">:approved_post</span> <span class="k">do</span>
    <span class="n">approved</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">approved_post</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:approved_post</span><span class="p">)</span>
<span class="n">approved_post</span><span class="o">.</span><span class="n">title</span>    <span class="c1"># =&gt; "A title"</span>
<span class="n">approved_post</span><span class="o">.</span><span class="n">approved</span> <span class="c1"># =&gt; true</span>
</pre></div>

<p>You can also assign the parent explicitly:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">title</span> <span class="s2">"A title"</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:approved_post</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">approved</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>As mentioned above, it's good practice to define a basic factory for each class
with only the attributes required to create it. Then, create more specific
factories that inherit from this basic parent. Factory definitions are still
code, so keep them DRY.</p>

<h2>Sequences</h2>

<p>Unique values in a specific format (for example, e-mail addresses) can be
generated using sequences. Sequences are defined by calling sequence in a
definition block, and values in a sequence are generated by calling
FactoryGirl.generate:</p>

<div class="highlight"><pre><span class="c1"># Defines a new sequence</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">sequence</span> <span class="ss">:email</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
    <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">generate</span> <span class="ss">:email</span>
<span class="c1"># =&gt; "person1@example.com"</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">generate</span> <span class="ss">:email</span>
<span class="c1"># =&gt; "person2@example.com"</span>
</pre></div>

<p>Sequences can be used as attributes:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">email</span>
<span class="k">end</span>
</pre></div>

<p>Or in lazy attributes:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:invite</span> <span class="k">do</span>
  <span class="n">invitee</span> <span class="p">{</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>And it's also possible to define an in-line sequence that is only used in
a particular factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>You can also override the initial value:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Without a block, the value will increment itself, starting at its initial value:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:position</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Sequences can also have aliases. The sequence aliases share the same counter:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:sender</span><span class="p">,</span> <span class="ss">:receiver</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># will increase value counter for :email which is shared by :sender and :receiver</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="ss">:sender</span><span class="p">)</span>
</pre></div>

<p>Define aliases and use default value (1) for the counter</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:sender</span><span class="p">,</span> <span class="ss">:receiver</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Setting the value:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">sequence</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:sender</span><span class="p">,</span> <span class="ss">:receiver</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>The value just needs to support the <code>#next</code> method. Here the next value will be 'a', then 'b', etc.</p>

<h2>Traits</h2>

<p>Traits allow you to group attributes together and then apply them
to any factory.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:author</span><span class="o">]</span>

<span class="n">factory</span> <span class="ss">:story</span> <span class="k">do</span>
  <span class="n">title</span> <span class="s2">"My awesome story"</span>
  <span class="n">author</span>

  <span class="n">trait</span> <span class="ss">:published</span> <span class="k">do</span>
    <span class="n">published</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:unpublished</span> <span class="k">do</span>
    <span class="n">published</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:week_long_publishing</span> <span class="k">do</span>
    <span class="n">start_at</span> <span class="p">{</span> <span class="mi">1</span><span class="o">.</span><span class="n">week</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
    <span class="n">end_at</span>   <span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:month_long_publishing</span> <span class="k">do</span>
    <span class="n">start_at</span> <span class="p">{</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
    <span class="n">end_at</span>   <span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">factory</span> <span class="ss">:week_long_published_story</span><span class="p">,</span>    <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:published</span><span class="p">,</span> <span class="ss">:week_long_publishing</span><span class="o">]</span>
  <span class="n">factory</span> <span class="ss">:month_long_published_story</span><span class="p">,</span>   <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:published</span><span class="p">,</span> <span class="ss">:month_long_publishing</span><span class="o">]</span>
  <span class="n">factory</span> <span class="ss">:week_long_unpublished_story</span><span class="p">,</span>  <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:unpublished</span><span class="p">,</span> <span class="ss">:week_long_publishing</span><span class="o">]</span>
  <span class="n">factory</span> <span class="ss">:month_long_unpublished_story</span><span class="p">,</span> <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:unpublished</span><span class="p">,</span> <span class="ss">:month_long_publishing</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>

<p>Traits can be used as attributes:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:week_long_published_story_with_title</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="ss">:story</span> <span class="k">do</span>
  <span class="n">published</span>
  <span class="n">week_long_publishing</span>
  <span class="n">title</span> <span class="p">{</span> <span class="s2">"Publishing that was started at {start_at}"</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Traits that define the same attributes won't raise AttributeDefinitionErrors;
the trait that defines the attribute latest gets precedence.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>
  <span class="n">login</span> <span class="p">{</span> <span class="nb">name</span> <span class="p">}</span>

  <span class="n">trait</span> <span class="ss">:male</span> <span class="k">do</span>
    <span class="nb">name</span>   <span class="s2">"John Doe"</span>
    <span class="n">gender</span> <span class="s2">"Male"</span>
    <span class="n">login</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> (M)"</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:female</span> <span class="k">do</span>
    <span class="nb">name</span>   <span class="s2">"Jane Doe"</span>
    <span class="n">gender</span> <span class="s2">"Female"</span>
    <span class="n">login</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> (F)"</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">admin</span> <span class="kp">true</span>
    <span class="n">login</span> <span class="p">{</span> <span class="s2">"admin-</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">factory</span> <span class="ss">:male_admin</span><span class="p">,</span>   <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:male</span><span class="p">,</span> <span class="ss">:admin</span><span class="o">]</span>   <span class="c1"># login will be "admin-John Doe"</span>
  <span class="n">factory</span> <span class="ss">:female_admin</span><span class="p">,</span> <span class="n">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="ss">:female</span><span class="o">]</span> <span class="c1"># login will be "Jane Doe (F)"</span>
<span class="k">end</span>
</pre></div>

<p>You can also override individual attributes granted by a trait in subclasses.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>
  <span class="n">login</span> <span class="p">{</span> <span class="nb">name</span> <span class="p">}</span>

  <span class="n">trait</span> <span class="ss">:male</span> <span class="k">do</span>
    <span class="nb">name</span>   <span class="s2">"John Doe"</span>
    <span class="n">gender</span> <span class="s2">"Male"</span>
    <span class="n">login</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> (M)"</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">factory</span> <span class="ss">:brandon</span> <span class="k">do</span>
    <span class="n">male</span>
    <span class="nb">name</span> <span class="s2">"Brandon"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Traits can also be passed in as a list of symbols when you construct an instance from FactoryGirl.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>

  <span class="n">trait</span> <span class="ss">:male</span> <span class="k">do</span>
    <span class="nb">name</span>   <span class="s2">"John Doe"</span>
    <span class="n">gender</span> <span class="s2">"Male"</span>
  <span class="k">end</span>

  <span class="n">trait</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">admin</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># creates an admin user with gender "Male" and name "Jon Snow"</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:male</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">"Jon Snow"</span><span class="p">)</span>
</pre></div>

<p>This ability works with <code>build</code>, <code>build_stubbed</code>, <code>attributes_for</code>, and <code>create</code>.</p>

<p><code>create_list</code> and <code>build_list</code> methods are supported as well. Just remember to pass
the number of instances to create/build as second parameter, as documented in the
"Building or Creating Multiple Records" section of this file.</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>

  <span class="n">trait</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">admin</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># creates 3 admin users with gender "Male" and name "Jon Snow"</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create_list</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:male</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">"Jon Snow"</span><span class="p">)</span>
</pre></div>

<p>Traits can be used with associations easily too:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>

  <span class="n">trait</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">admin</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">association</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'John Doe'</span>
<span class="k">end</span>

<span class="c1"># creates an admin user with name "John Doe"</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span><span class="o">.</span><span class="n">user</span>
</pre></div>

<p>When you're using association names that're different than the factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Friendly User"</span>

  <span class="n">trait</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">admin</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">association</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="n">factory</span><span class="p">:</span> <span class="ss">:user</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'John Doe'</span>
  <span class="c1"># or</span>
  <span class="n">association</span> <span class="ss">:author</span><span class="p">,</span> <span class="n">factory</span><span class="p">:</span> <span class="o">[</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'John Doe'</span>
<span class="k">end</span>

<span class="c1"># creates an admin user with name "John Doe"</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span><span class="o">.</span><span class="n">author</span>
</pre></div>

<h2>Callbacks</h2>

<p>factory_girl makes available four callbacks for injecting some code:</p>

<ul>
<li>after(:build)   - called after a factory is built   (via <code>FactoryGirl.build</code>, <code>FactoryGirl.create</code>)</li>
<li>before(:create) - called before a factory is saved  (via <code>FactoryGirl.create</code>)</li>
<li>after(:create)  - called after a factory is saved   (via <code>FactoryGirl.create</code>)</li>
<li>after(:stub)    - called after a factory is stubbed (via <code>FactoryGirl.build_stubbed</code>)</li>
</ul><p>Examples:</p>

<div class="highlight"><pre><span class="c1"># Define a factory that calls the generate_hashed_password method after it is built</span>
<span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:build</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">generate_hashed_password</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Note that you'll have an instance of the user in the block. This can be useful.</p>

<p>You can also define multiple types of callbacks on the same factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:build</span><span class="p">)</span>  <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">do_something_to</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">do_something_else_to</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Factories can also define any number of the same kind of callback.  These callbacks will be executed in the order they are specified:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="n">this_runs_first</span> <span class="p">}</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="n">then_this</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Calling FactoryGirl.create will invoke both <code>after_build</code> and <code>after_create</code> callbacks.</p>

<p>Also, like standard attributes, child factories will inherit (and can also define) callbacks from their parent factory.</p>

<p>Multiple callbacks can be assigned to run a block; this is useful when building various strategies that run the same code (since there are no callbacks that are shared across all strategies).</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">callback</span><span class="p">(</span><span class="ss">:after_stub</span><span class="p">,</span> <span class="ss">:before_create</span><span class="p">)</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}</span>
  <span class="n">after</span><span class="p">(</span><span class="ss">:stub</span><span class="p">,</span> <span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="n">do_something_else</span> <span class="p">}</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:custom</span><span class="p">)</span> <span class="p">{</span> <span class="n">do_a_third_thing</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<h2>Modifying factories</h2>

<p>If you're given a set of factories (say, from a gem developer) but want to change them to fit into your application better, you can
modify that factory instead of creating a child factory and adding attributes there.</p>

<p>If a gem were to give you a User factory:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">full_name</span> <span class="s2">"John Doe"</span>
    <span class="n">sequence</span><span class="p">(</span><span class="ss">:username</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"user</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
    <span class="n">password</span> <span class="s2">"password"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Instead of creating a child factory that added additional attributes:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:application_user</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">full_name</span>     <span class="s2">"Jane Doe"</span>
    <span class="n">date_of_birth</span> <span class="p">{</span> <span class="mi">21</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
    <span class="n">gender</span>        <span class="s2">"Female"</span>
    <span class="n">health</span>        <span class="mi">90</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>You could modify that factory instead.</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">modify</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">full_name</span>     <span class="s2">"Jane Doe"</span>
    <span class="n">date_of_birth</span> <span class="p">{</span> <span class="mi">21</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
    <span class="n">gender</span>        <span class="s2">"Female"</span>
    <span class="n">health</span>        <span class="mi">90</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>When modifying a factory, you can change any of the attributes you want (aside from callbacks).</p>

<p><code>FactoryGirl.modify</code> must be called outside of a <code>FactoryGirl.define</code> block as it operates on factories differently.</p>

<p>A caveat: you can only modify factories (not sequences or traits) and callbacks <em>still compound as they normally would</em>. So, if
the factory you're modifying defines an <code>after(:create)</code> callback, you defining an <code>after(:create)</code> won't override it, it'll just get run after the first callback.</p>

<h2>Building or Creating Multiple Records</h2>

<p>Sometimes, you'll want to create or build multiple instances of a factory at once.</p>

<div class="highlight"><pre><span class="n">built_users</span>   <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build_list</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">created_users</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create_list</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>

<p>These methods will build or create a specific amount of factories and return them as an array.
To set the attributes for each of the factories, you can pass in a hash as you normally would.</p>

<div class="highlight"><pre><span class="n">twenty_year_olds</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build_list</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">:</span> <span class="mi">20</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span>
</pre></div>

<h2>Custom Construction</h2>

<p>If you want to use factory_girl to construct an object where some attributes
are passed to <code>initialize</code> or if you want to do something other than simply
calling <code>new</code> on your build class, you can override the default behavior by
defining <code>initialize_with</code> on your factory. Example:</p>

<div class="highlight"><pre><span class="c1"># user.rb</span>
<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># factories.rb</span>
<span class="n">sequence</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">"person</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@example.com"</span> <span class="p">}</span>

<span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">ignore</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s2">"Jane Doe"</span>
  <span class="k">end</span>

  <span class="n">email</span>
  <span class="n">initialize_with</span> <span class="p">{</span> <span class="kp">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="c1"># Jane Doe</span>
</pre></div>

<p>Notice that I ignored the <code>name</code> attribute. If you don't want attributes
reassigned after your object has been instantiated, you'll want to <code>ignore</code> them.</p>

<p>Although factory_girl is written to work with ActiveRecord out of the box, it
can also work with any Ruby class. For maximum compatibiltiy with ActiveRecord,
the default initializer builds all instances by calling new on your build class
without any arguments. It then calls attribute writer methods to assign all the
attribute values. While that works fine for ActiveRecord, it actually doesn't
work for almost any other Ruby class.</p>

<p>You can override the initializer in order to:</p>

<ul>
<li>Build non-ActiveRecord objects that require arguments to <code>initialize</code>
</li>
<li>Use a method other than <code>new</code> to instantiate the instance</li>
<li>Do crazy things like decorate the instance after it's built</li>
</ul><p>When using <code>initialize_with</code>, you don't have to declare the class itself when
calling <code>new</code>; however, any other class methods you want to call will have to
be called on the class explicitly.</p>

<p>For example:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">ignore</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s2">"John Doe"</span>
  <span class="k">end</span>

  <span class="n">initialize_with</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">build_with_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>You can also access all public attributes within the <code>initialize_with</code> block
by calling <code>attributes</code>:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
  <span class="n">ignore</span> <span class="k">do</span>
    <span class="n">comments_count</span> <span class="mi">5</span>
  <span class="k">end</span>

  <span class="nb">name</span> <span class="s2">"John Doe"</span>

  <span class="n">initialize_with</span> <span class="p">{</span> <span class="kp">new</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>This will build a hash of all attributes to be passed to <code>new</code>. It won't
include ignored attributes, but everything else defined in the factory will be
passed (associations, evalued sequences, etc.)</p>

<p>You can define <code>initialize_with</code> for all factories by including it in the
<code>FactoryGirl.define</code> block:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">initialize_with</span> <span class="p">{</span> <span class="kp">new</span><span class="p">(</span><span class="s2">"Awesome first argument"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>When using <code>initialize_with</code>, attributes accessed from within the <code>initialize_with</code>
block are assigned <em>only</em> in the constructor; this equates to roughly the
following code:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">initialize_with</span> <span class="p">{</span> <span class="kp">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">}</span>

    <span class="nb">name</span> <span class="p">{</span> <span class="s1">'value'</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
<span class="c1"># runs</span>
<span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
</pre></div>

<p>This prevents duplicate assignment; in versions of FactoryGirl before 4.0, it
would run this:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">initialize_with</span> <span class="p">{</span> <span class="kp">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">}</span>

    <span class="nb">name</span> <span class="p">{</span> <span class="s1">'value'</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
<span class="c1"># runs</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'value'</span>
</pre></div>

<h2>Custom Strategies</h2>

<p>There are times where you may want to extend behavior of factory_girl by
adding a custom build strategy.</p>

<p>Strategies define two methods: <code>association</code> and <code>result</code>. <code>association</code>
receives a <code>FactoryGirl::FactoryRunner</code> instance, upon which you can call
<code>run</code>, overriding the strategy if you want. The second method, <code>result</code>,
receives a <code>FactoryGirl::Evaluation</code> instance. It provides a way to trigger
callbacks (with <code>notify</code>), <code>object</code> or <code>hash</code> (to get the result instance or a
hash based on the attributes defined in the factory), and <code>create</code>, which
executes the <code>to_create</code> callback defined on the factory.</p>

<p>To understand how factory_girl uses strategies internally, it's probably
easiest to just view the source for each of the four default strategies.</p>

<p>Here's an example of composing a strategy using
<code>FactoryGirl::Strategy::Create</code> to build a JSON representation of your model.</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">JsonStrategy</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@strategy</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">strategy_by_name</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="n">delegate</span> <span class="ss">:association</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="ss">:@strategy</span>

  <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span>
    <span class="vi">@strategy</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span><span class="o">.</span><span class="n">to_json</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>For factory_girl to recognize the new strategy, you can register it:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">register_strategy</span><span class="p">(</span><span class="ss">:json</span><span class="p">,</span> <span class="no">JsonStrategy</span><span class="p">)</span>
</pre></div>

<p>This allows you to call</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
</pre></div>

<p>Finally, you can override factory_girl's own strategies if you'd like by
registering a new object in place of the strategies.</p>

<h2>Custom Callbacks</h2>

<p>Custom callbacks can be defined if you're using custom strategies:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">JsonStrategy</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@strategy</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">strategy_by_name</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="n">delegate</span> <span class="ss">:association</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="ss">:@strategy</span>

  <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="vi">@strategy</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span>
    <span class="n">evaluation</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="ss">:before_json</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="n">result</span><span class="o">.</span><span class="n">to_json</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">json</span><span class="o">|</span>
      <span class="n">evaluation</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="ss">:after_json</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
      <span class="n">evaluation</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="ss">:make_json_awesome</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">register_strategy</span><span class="p">(</span><span class="ss">:json</span><span class="p">,</span> <span class="no">JsonStrategy</span><span class="p">)</span>

<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">before</span><span class="p">(</span><span class="ss">:json</span><span class="p">)</span>                <span class="p">{</span><span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">do_something_to</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">after</span><span class="p">(</span><span class="ss">:json</span><span class="p">)</span>                 <span class="p">{</span><span class="o">|</span><span class="n">user_json</span><span class="o">|</span> <span class="n">do_something_to</span><span class="p">(</span><span class="n">user_json</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">callback</span><span class="p">(</span><span class="ss">:make_json_awesome</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">user_json</span><span class="o">|</span> <span class="n">do_something_to</span><span class="p">(</span><span class="n">user_json</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>Custom Methods to Persist Objects</h2>

<p>By default, creating a record will call <code>save!</code> on the instance; since this
may not always be ideal, you can override that behavior by defining
<code>to_create</code> on the factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:different_orm_model</span> <span class="k">do</span>
  <span class="n">to_create</span> <span class="p">{</span><span class="o">|</span><span class="n">instance</span><span class="o">|</span> <span class="n">instance</span><span class="o">.</span><span class="n">persist!</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>To disable the persistence method altogether on create, you can <code>skip_create</code>
for that factory:</p>

<div class="highlight"><pre><span class="n">factory</span> <span class="ss">:user_without_database</span> <span class="k">do</span>
  <span class="n">skip_create</span>
<span class="k">end</span>
</pre></div>

<p>To override <code>to_create</code> for all factories, define it within the
<code>FactoryGirl.define</code> block:</p>

<div class="highlight"><pre><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">to_create</span> <span class="p">{</span><span class="o">|</span><span class="n">instance</span><span class="o">|</span> <span class="n">instance</span><span class="o">.</span><span class="n">persist!</span> <span class="p">}</span>


  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s2">"John Doe"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>ActiveSupport Instrumentation</h2>

<p>In order to track what factories are created (and with what build strategy),
<code>ActiveSupport::Notifications</code> are included to provide a way to subscribe to
factories being run. One example would be to track factories based on a
threshold of execution time.</p>

<div class="highlight"><pre><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">"factory_girl.run_factory"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">payload</span><span class="o">|</span>
  <span class="n">execution_time_in_seconds</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span>

  <span class="k">if</span> <span class="n">execution_time_in_seconds</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"Slow factory: </span><span class="si">#{</span><span class="n">payload</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2"> using strategy </span><span class="si">#{</span><span class="n">payload</span><span class="o">[</span><span class="ss">:strategy</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Another example would be tracking all factories and how they're used
throughout your test suite. If you're using RSpec, it's as simple as adding a
<code>before(:suite)</code> and <code>after(:suite)</code>:</p>

<div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
  <span class="vi">@factory_girl_results</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">"factory_girl.run_factory"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">payload</span><span class="o">|</span>
    <span class="n">factory_name</span> <span class="o">=</span> <span class="n">payload</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
    <span class="n">strategy_name</span> <span class="o">=</span> <span class="n">payload</span><span class="o">[</span><span class="ss">:strategy</span><span class="o">]</span>
    <span class="vi">@factory_girl_results</span><span class="o">[</span><span class="n">factory_name</span><span class="o">]</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="vi">@factory_girl_results</span><span class="o">[</span><span class="n">factory_name</span><span class="o">][</span><span class="n">strategy_name</span><span class="o">]</span> <span class="o">||=</span> <span class="mi">0</span>
    <span class="vi">@factory_girl_results</span><span class="o">[</span><span class="n">factory_name</span><span class="o">][</span><span class="n">strategy_name</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="vi">@factory_girl_results</span>
<span class="k">end</span>
</pre></div>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/thoughtbot">thoughtbot</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>